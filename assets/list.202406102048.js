import{_ as U}from"./index.20240610204819.js";import{d as M,u as j,c as S,e as n,f as v,g as o,t as u,S as Q,h,k as m,n as b,j as N,w as d,l as I,D as x,F as V,s as R,_ as q,E as G,o as H,a as O,b as w,i as F}from"./index.202406102048.js";import{A as J}from"./index.20240610204824.js";import{d as K}from"./format.202406102048.js";import{P as W}from"./index.20240610204829.js";import{u as X}from"./order.202406102048.js";import"./index.20240610204822.js";import"./is.202406102048.js";import"./function-call.202406102048.js";function Y(t,$){const f=[];return t.forEach(l=>{const y=$[l.id]||[];f.push({...l,goodsInfo:y.length?y[0]:{}})}),f}const Z={class:"list-item"},tt={class:"list-item-header van-hairline--bottom"},et={class:"list-item-header-hd"},st={class:"title"},ot={key:0,class:"good-card"},nt={class:"good-card-content"},it={class:"good-card-content-hd"},at={class:"good-card-title"},rt={key:0,class:"good-card-prop"},ct={class:"good-card-content-bd"},dt={class:"good-card-price"},lt={class:"good-card-number"},ut={key:1,class:"list-item-more"},mt={class:"list-item-total van-hairline--top"},vt={class:"list-item-total-number"},ft={class:"list-item-total-price"},_t={class:"list-item-total-price-label"},gt={class:"list-item-footer van-hairline--top"},ht=M({__name:"OrderItem",props:{item:{type:Object,default:()=>{}},index:{type:Number,default:0}},emits:["delete"],setup(t,{emit:$}){const f=$,l=j(),y=X();function r(i){const{orderNumber:e}=i;l.push({path:"/order/detail",query:{orderNumber:e}})}function L(i){R("未开放：客服")}function p(i){y.closeOrder({orderId:i.id}).then(()=>{R({message:"取消订单成功",duration:1500}),i.status=-1,i.statusStr="订单关闭"}).catch(e=>{console.error(e)})}function k(i,e){y.deleteOrder({orderId:i.id}).then(()=>{R({message:"删除订单成功",duration:1500}),f("delete",i,e)}).catch(C=>{console.error(C)})}return(i,e)=>{const C=S("van-image"),_=S("van-button");return n(),v("div",Z,[o("div",tt,[o("div",et,[o("span",st,"订单编号："+u(t.item.orderNumber),1)]),o("div",{class:Q(["list-item-header-state",t.item.status!==-1?"text-primary-color":""])},u(t.item.statusStr),3)]),o("div",{class:"list-item-body",onClick:e[0]||(e[0]=g=>r(t.item))},[t.item.goodsInfo?(n(),v("div",ot,[h(C,{fit:"contain",class:"good-card-pic",src:t.item.goodsInfo.pic},null,8,["src"]),o("div",nt,[o("div",it,[o("div",at,u(t.item.goodsInfo.goodsName),1),t.item.goodsInfo.property?(n(),v("div",rt,u(t.item.goodsInfo.property),1)):m("",!0)]),o("div",ct,[o("div",dt,"¥"+u(b(K)(t.item.goodsInfo.amount)),1),o("div",lt,"x"+u(t.item.goodsInfo.number),1)])])])):m("",!0),t.item.goodsNumber>1?(n(),v("div",ut,"查看全部"+u(t.item.goodsNumber)+"件商品",1)):m("",!0),o("div",mt,[o("span",vt,"共"+u(t.item.goodsNumber)+"件商品",1),o("div",ft,[o("span",_t,u(t.item.status===0?"需付款：":"实付款："),1),h(W,{price:t.item.amountReal},null,8,["price"])])])]),o("div",gt,[t.item.status===-1||t.item.status===3||t.item.status===4?(n(),N(_,{key:0,class:"list-item-action-btn",round:"",onClick:e[1]||(e[1]=x(g=>k(t.item,t.index),["stop"]))},{default:d(()=>[I(" 删除订单 ")]),_:1})):m("",!0),t.item.status===0?(n(),v(V,{key:1},[h(_,{class:"list-item-action-btn",round:"",plain:"",onClick:e[2]||(e[2]=x(g=>p(t.item),["stop"]))},{default:d(()=>[I(" 取消订单 ")]),_:1}),h(_,{class:"list-item-action-btn",round:"",plain:"",type:"primary",onClick:e[3]||(e[3]=x(g=>r(t.item),["stop"]))},{default:d(()=>[I(" 去支付 ")]),_:1})],64)):m("",!0),t.item.status===1?(n(),N(_,{key:2,icon:"service",class:"list-item-action-btn",round:"",onClick:e[4]||(e[4]=x(g=>L(t.item),["stop"]))},{default:d(()=>[I(" 联系客服 ")]),_:1})):m("",!0),t.item.status===2?(n(),N(_,{key:3,class:"list-item-action-btn",round:"",onClick:e[5]||(e[5]=x(g=>r(t.item),["stop"]))},{default:d(()=>[I("确认收货")]),_:1})):m("",!0),t.item.status===3?(n(),N(_,{key:4,class:"list-item-action-btn",round:"",onClick:e[6]||(e[6]=x(g=>r(t.item),["stop"]))},{default:d(()=>[I("评价")]),_:1})):m("",!0)])])}}});const yt=q(ht,[["__scopeId","data-v-c628e5b2"]]),bt={class:"container"},pt={class:"header"},kt={action:"#",class:"search-form"},Ct={class:"list"},It={name:"OrderList"},xt=M({...It,setup(t){const $=G();H(()=>{var a;const{status:s}=$.query;s&&(l.value=b(f).findIndex(T=>T.status===s)),(a=p.value)==null||a.loadData()});const f=O([{name:"全部",status:""},{name:"待付款",status:"0"},{name:"待发货",status:"1"},{name:"待收货",status:"2"},{name:"待评价",status:"3"}]),l=O(0);function y(){var s;e.value="query",(s=p.value)==null||s.refresh()}const r=O("");function L(){var s;e.value="search",(s=p.value)==null||s.refresh()}const p=O(null),k=O([]),i=w({pageCurrent:1,pageSize:10}),e=O("query"),C=w({loadingText:"订单加载中...",emptyText:"暂无订单"});function _(s,a){k.value.splice(a,1)}function g(){const s={page:i.pageCurrent,pageSize:i.pageSize,status:b(f)[b(l)].status};return b(r)&&(s.orderNumber=b(r)),C.emptyText=b(e)==="search"?"未找到符合条件数据":"暂无订单",J.orderList(s)}function z(s){return Y((s==null?void 0:s.orderList)??[],(s==null?void 0:s.goodsMap)??[])}return(s,a)=>{const T=S("van-search"),B=S("van-tab"),E=S("van-tabs"),P=S("van-sticky"),A=U;return n(),v("div",bt,[h(P,null,{default:d(()=>[o("div",pt,[o("form",kt,[h(T,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=c=>r.value=c),class:"search-field",shape:"round","show-action":"",placeholder:"搜索订单（订单编号）",onSearch:L},{action:d(()=>[r.value?(n(),v("div",{key:0,onClick:L},"搜索")):m("",!0)]),_:1},8,["modelValue"])]),h(E,{active:l.value,"onUpdate:active":a[1]||(a[1]=c=>l.value=c),onClickTab:y},{default:d(()=>[(n(!0),v(V,null,F(f.value,(c,D)=>(n(),N(B,{key:D,title:c.name},null,8,["title"]))),128))]),_:1},8,["active"])])]),_:1}),h(A,{ref_key:"listRef",ref:p,dataSource:k.value,"onUpdate:dataSource":a[2]||(a[2]=c=>k.value=c),mode:"infinite",api:g,afterFetch:z,pagination:i,meta:C},{default:d(()=>[o("div",Ct,[(n(!0),v(V,null,F(k.value,(c,D)=>(n(),N(yt,{key:c.id,item:c,index:D,onDelete:_},null,8,["item","index"]))),128))])]),_:1},8,["dataSource","pagination","meta"])])}}});const wt=q(xt,[["__scopeId","data-v-1e113e6f"]]);export{wt as default};
