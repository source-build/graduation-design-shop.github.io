import{_ as Pe}from"./index.20240610204831.js";import{_ as Se}from"./index.vue_vue_type_script_setup_true_lang.202406102048.js";import{r as Ie,d as _e,v as xe,x as G,_ as Be,c as N,e as Ue,j as je,w as Re,a6 as Le,o as Me,n as f,u as We,B as He,q as ve,a as S,f as ze,g as A,h as D,s as I,C as $e,p as Ve,m as Ge}from"./index.202406102048.js";import{c as de}from"./validate.202406102048.js";import{a as Ne}from"./index.20240610204826.js";import"./is.202406102048.js";function Xe(a,e,r={}){const t={type:a.type,...r};return new File([a],e,t)}/*!
 * Compressor.js v1.2.1
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-02-28T14:09:41.732Z
 */function me(a,e){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);e&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),r.push.apply(r,t)}return r}function j(a){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?me(Object(r),!0).forEach(function(t){Ke(a,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):me(Object(r)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(r,t))})}return a}function Ye(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function pe(a,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,Ae(t.key),t)}}function qe(a,e,r){return e&&pe(a.prototype,e),r&&pe(a,r),Object.defineProperty(a,"prototype",{writable:!1}),a}function Ke(a,e,r){return e=Ae(e),e in a?Object.defineProperty(a,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[e]=r,a}function L(){return L=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(a[t]=r[t])}return a},L.apply(this,arguments)}function Je(a,e){if(typeof a!="object"||a===null)return a;var r=a[Symbol.toPrimitive];if(r!==void 0){var t=r.call(a,e||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function Ae(a){var e=Je(a,"string");return typeof e=="symbol"?e:String(e)}var Ee={exports:{}};(function(a){typeof window>"u"||function(e){var r=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,t=e.Blob&&function(){try{return!!new Blob}catch{return!1}}(),i=t&&e.Uint8Array&&function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}}(),n=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,l=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,s=(t||n)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(c){var u,h,d,m,v,o,y,p,w;if(u=c.match(l),!u)throw new Error("invalid data URI");for(h=u[2]?u[1]:"text/plain"+(u[3]||";charset=US-ASCII"),d=!!u[4],m=c.slice(u[0].length),d?v=atob(m):v=decodeURIComponent(m),o=new ArrayBuffer(v.length),y=new Uint8Array(o),p=0;p<v.length;p+=1)y[p]=v.charCodeAt(p);return t?new Blob([i?y:o],{type:h}):(w=new n,w.append(o),w.getBlob(h))};e.HTMLCanvasElement&&!r.toBlob&&(r.mozGetAsFile?r.toBlob=function(c,u,h){var d=this;setTimeout(function(){h&&r.toDataURL&&s?c(s(d.toDataURL(u,h))):c(d.mozGetAsFile("blob",u))})}:r.toDataURL&&s&&(r.msToBlob?r.toBlob=function(c,u,h){var d=this;setTimeout(function(){(u&&u!=="image/png"||h)&&r.toDataURL&&s?c(s(d.toDataURL(u,h))):c(d.msToBlob(u))})}:r.toBlob=function(c,u,h){var d=this;setTimeout(function(){c(s(d.toDataURL(u,h)))})})),a.exports?a.exports=s:e.dataURLtoBlob=s}(window)})(Ee);var ge=Ee.exports,Qe=function(e){return typeof Blob>"u"?!1:e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"},be={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},Ze=typeof window<"u"&&typeof window.document<"u",_=Ze?window:{},M=function(e){return e>0&&e<1/0},et=Array.prototype.slice;function Y(a){return Array.from?Array.from(a):et.call(a)}var tt=/^image\/.+$/;function X(a){return tt.test(a)}function rt(a){var e=X(a)?a.substr(6):"";return e==="jpeg"&&(e="jpg"),".".concat(e)}var Te=String.fromCharCode;function at(a,e,r){var t="",i;for(r+=e,i=e;i<r;i+=1)t+=Te(a.getUint8(i));return t}var it=_.btoa;function ye(a,e){for(var r=[],t=8192,i=new Uint8Array(a);i.length>0;)r.push(Te.apply(null,Y(i.subarray(0,t)))),i=i.subarray(t);return"data:".concat(e,";base64,").concat(it(r.join("")))}function nt(a){var e=new DataView(a),r;try{var t,i,n;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var l=e.byteLength,s=2;s+1<l;){if(e.getUint8(s)===255&&e.getUint8(s+1)===225){i=s;break}s+=1}if(i){var c=i+4,u=i+10;if(at(e,c,4)==="Exif"){var h=e.getUint16(u);if(t=h===18761,(t||h===19789)&&e.getUint16(u+2,t)===42){var d=e.getUint32(u+4,t);d>=8&&(n=u+d)}}}if(n){var m=e.getUint16(n,t),v,o;for(o=0;o<m;o+=1)if(v=n+o*12+2,e.getUint16(v,t)===274){v+=8,r=e.getUint16(v,t),e.setUint16(v,1,t);break}}}catch{r=1}return r}function ot(a){var e=0,r=1,t=1;switch(a){case 2:r=-1;break;case 3:e=-180;break;case 4:t=-1;break;case 5:e=90,t=-1;break;case 6:e=90;break;case 7:e=90,r=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:r,scaleY:t}}var st=/\.\d*(?:0|9){12}\d*$/;function we(a){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return st.test(a)?Math.round(a*e)/e:a}function P(a){var e=a.aspectRatio,r=a.height,t=a.width,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",n=M(t),l=M(r);if(n&&l){var s=r*e;(i==="contain"||i==="none")&&s>t||i==="cover"&&s<t?r=t/e:t=r*e}else n?r=t/e:l&&(t=r*e);return{width:t,height:r}}function lt(a){for(var e=Y(new Uint8Array(a)),r=e.length,t=[],i=0;i+3<r;){var n=e[i],l=e[i+1];if(n===255&&l===218)break;if(n===255&&l===216)i+=2;else{var s=e[i+2]*256+e[i+3],c=i+s+2,u=e.slice(i,c);t.push(u),i=c}}return t.reduce(function(h,d){return d[0]===255&&d[1]===225?h.concat(d):h},[])}function ct(a,e){var r=Y(new Uint8Array(a));if(r[2]!==255||r[3]!==224)return a;var t=r[4]*256+r[5],i=[255,216].concat(e,r.slice(4+t));return new Uint8Array(i)}var ut=_.ArrayBuffer,V=_.FileReader,B=_.URL||_.webkitURL,ft=/\.\w+$/,ht=_.Compressor,vt=function(){function a(e,r){Ye(this,a),this.file=e,this.exif=[],this.image=new Image,this.options=j(j({},be),r),this.aborted=!1,this.result=null,this.init()}return qe(a,[{key:"init",value:function(){var r=this,t=this.file,i=this.options;if(!Qe(t)){this.fail(new Error("The first argument must be a File or Blob object."));return}var n=t.type;if(!X(n)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!B||!V){this.fail(new Error("The current browser does not support image compression."));return}ut||(i.checkOrientation=!1,i.retainExif=!1);var l=n==="image/jpeg",s=l&&i.checkOrientation,c=l&&i.retainExif;if(B&&!s&&!c)this.load({url:B.createObjectURL(t)});else{var u=new V;this.reader=u,u.onload=function(h){var d=h.target,m=d.result,v={},o=1;s&&(o=nt(m),o>1&&L(v,ot(o))),c&&(r.exif=lt(m)),s||c?!B||o>1?v.url=ye(m,n):v.url=B.createObjectURL(t):v.url=m,r.load(v)},u.onabort=function(){r.fail(new Error("Aborted to read the image with FileReader."))},u.onerror=function(){r.fail(new Error("Failed to read the image with FileReader."))},u.onloadend=function(){r.reader=null},s||c?u.readAsArrayBuffer(t):u.readAsDataURL(t)}}},{key:"load",value:function(r){var t=this,i=this.file,n=this.image;n.onload=function(){t.draw(j(j({},r),{},{naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight}))},n.onabort=function(){t.fail(new Error("Aborted to load the image."))},n.onerror=function(){t.fail(new Error("Failed to load the image."))},_.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(_.navigator.userAgent)&&(n.crossOrigin="anonymous"),n.alt=i.name,n.src=r.url}},{key:"draw",value:function(r){var t=this,i=r.naturalWidth,n=r.naturalHeight,l=r.rotate,s=l===void 0?0:l,c=r.scaleX,u=c===void 0?1:c,h=r.scaleY,d=h===void 0?1:h,m=this.file,v=this.image,o=this.options,y=document.createElement("canvas"),p=y.getContext("2d"),w=Math.abs(s)%180===90,E=(o.resize==="contain"||o.resize==="cover")&&M(o.width)&&M(o.height),x=Math.max(o.maxWidth,0)||1/0,T=Math.max(o.maxHeight,0)||1/0,F=Math.max(o.minWidth,0)||0,k=Math.max(o.minHeight,0)||0,U=i/n,g=o.width,b=o.height;if(w){var q=[T,x];x=q[0],T=q[1];var K=[k,F];F=K[0],k=K[1];var J=[b,g];g=J[0],b=J[1]}E&&(U=g/b);var Q=P({aspectRatio:U,width:x,height:T},"contain");x=Q.width,T=Q.height;var Z=P({aspectRatio:U,width:F,height:k},"cover");if(F=Z.width,k=Z.height,E){var ee=P({aspectRatio:U,width:g,height:b},o.resize);g=ee.width,b=ee.height}else{var te=P({aspectRatio:U,width:g,height:b}),re=te.width;g=re===void 0?i:re;var ae=te.height;b=ae===void 0?n:ae}g=Math.floor(we(Math.min(Math.max(g,F),x))),b=Math.floor(we(Math.min(Math.max(b,k),T)));var ke=-g/2,Ce=-b/2,Oe=g,De=b,W=[];if(E){var ie=0,ne=0,H=i,z=n,oe=P({aspectRatio:U,width:i,height:n},{contain:"cover",cover:"contain"}[o.resize]);H=oe.width,z=oe.height,ie=(i-H)/2,ne=(n-z)/2,W.push(ie,ne,H,z)}if(W.push(ke,Ce,Oe,De),w){var se=[b,g];g=se[0],b=se[1]}y.width=g,y.height=b,X(o.mimeType)||(o.mimeType=m.type);var le="transparent";m.size>o.convertSize&&o.convertTypes.indexOf(o.mimeType)>=0&&(o.mimeType="image/jpeg");var ce=o.mimeType==="image/jpeg";if(ce&&(le="#fff"),p.fillStyle=le,p.fillRect(0,0,g,b),o.beforeDraw&&o.beforeDraw.call(this,p,y),!this.aborted&&(p.save(),p.translate(g/2,b/2),p.rotate(s*Math.PI/180),p.scale(u,d),p.drawImage.apply(p,[v].concat(W)),p.restore(),o.drew&&o.drew.call(this,p,y),!this.aborted)){var ue=function(C){if(!t.aborted){var fe=function(O){return t.done({naturalWidth:i,naturalHeight:n,result:O})};if(C&&ce&&o.retainExif&&t.exif&&t.exif.length>0){var he=function(O){return fe(ge(ye(ct(O,t.exif),o.mimeType)))};if(C.arrayBuffer)C.arrayBuffer().then(he).catch(function(){t.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var R=new V;t.reader=R,R.onload=function($){var O=$.target;he(O.result)},R.onabort=function(){t.fail(new Error("Aborted to read the compressed image with FileReader."))},R.onerror=function(){t.fail(new Error("Failed to read the compressed image with FileReader."))},R.onloadend=function(){t.reader=null},R.readAsArrayBuffer(C)}}else fe(C)}};y.toBlob?y.toBlob(ue,o.mimeType,o.quality):ue(ge(y.toDataURL(o.mimeType,o.quality)))}}},{key:"done",value:function(r){var t=r.naturalWidth,i=r.naturalHeight,n=r.result,l=this.file,s=this.image,c=this.options;if(B&&s.src.indexOf("blob:")===0&&B.revokeObjectURL(s.src),n)if(c.strict&&!c.retainExif&&n.size>l.size&&c.mimeType===l.type&&!(c.width>t||c.height>i||c.minWidth>t||c.minHeight>i||c.maxWidth<t||c.maxHeight<i))n=l;else{var u=new Date;n.lastModified=u.getTime(),n.lastModifiedDate=u,n.name=l.name,n.name&&n.type!==l.type&&(n.name=n.name.replace(ft,rt(n.type)))}else n=l;this.result=n,c.success&&c.success.call(this,n)}},{key:"fail",value:function(r){var t=this.options;if(t.error)t.error.call(this,r);else throw r}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ht,a}},{key:"setDefaults",value:function(r){L(be,r)}}]),a}();function dt(a){return Ie({url:"/dfs/upload/file",method:"post",data:a,headers:{"Content-Type":"multipart/form-data"}})}const mt={dfsUploadFile:dt},pt=_e({name:"UploadAvatar",emits:["success","error"],setup(a,{emit:e}){function r(i){return new Promise(n=>{new vt(i,{quality:.8,maxWidth:1024,success:async l=>{const s=Xe(l,i.name);n(s)},error:l=>{console.error("[Compressor error]",l),e("error",l)}})})}async function t(i){const n=i.file,l=new FormData;l.append("upfile",n),xe({forbidClick:!0,message:"上传中...",duration:0}),mt.dfsUploadFile(l).then(s=>{G(),e("success",s)}).catch(s=>{console.error(s),G(),e("error",s)})}return{beforeRead:r,afterRead:t}}});function gt(a,e,r,t,i,n){const l=N("van-uploader");return Ue(),je(l,{"before-read":a.beforeRead,"after-read":a.afterRead},{default:Re(()=>[Le(a.$slots,"default")]),_:3},8,["before-read","after-read"])}const bt=Be(pt,[["render",gt]]),Fe=a=>(Ve("data-v-e57e71d9"),a=a(),Ge(),a),yt={class:"container"},wt={class:"header"},_t={class:"avatar"},xt=Fe(()=>A("div",{class:"avatar-title"},"点击更换头像",-1)),Bt={class:"main"},Ut={class:"nick"},Rt=Fe(()=>A("div",{class:"nick-label"},"昵称",-1)),At=_e({__name:"index",setup(a){Me(()=>{i.value=f(t).avatarUrl??"",n.value=f(t).nick??"",l.value=f(t).province??"",s.value=f(t).city??""});const e=We(),r=He(),t=ve(()=>r.getUserInfo),i=S(""),n=S(""),l=S(""),s=S(""),c=ve(()=>f(l)?f(l)===f(s)?f(s):`${f(l)} - ${f(s)}`:"");function u(m){i.value=m.data.url}function h({selectedOptions:m}){l.value=m[0].text,s.value=m[1].text}function d(){if(f(i)===f(t).avatarUrl&&f(n)===f(t).nick&&f(l)===f(t).province&&f(s)===f(t).city){I("您没有修改任何东西哦");return}if(de(f(n))){I("昵称不能为空");return}if(de(f(l))){I("所在地不能为空");return}const m={nick:f(n),avatarUrl:f(i),province:f(l),city:f(s)};xe({forbidClick:!0,message:"提交中...",duration:0}),$e.userModify(m).then(()=>{G(),I("资料修改成功"),e.back()}).catch(v=>{console.error(v)})}return(m,v)=>{const o=N("van-image"),y=bt,p=N("van-field"),w=Se,E=Pe;return Ue(),ze("div",yt,[A("div",wt,[D(y,{onSuccess:u},{default:Re(()=>[A("div",_t,[D(o,{class:"avatar-img",src:i.value||f(Ne).avatar},null,8,["src"]),xt])]),_:1})]),A("div",Bt,[A("div",Ut,[Rt,D(p,{modelValue:n.value,"onUpdate:modelValue":v[0]||(v[0]=x=>n.value=x),placeholder:"12个字以内"},null,8,["modelValue"])]),D(w,{"model-value":c.value,label:"所在地",placeholder:"点击选择城市","input-align":"right",border:!1,"columns-num":2,onChange:h},null,8,["model-value"])]),D(E,{size:"medium",onClickBtn:d})])}}});const Pt=Be(At,[["__scopeId","data-v-e57e71d9"]]);export{Pt as default};
