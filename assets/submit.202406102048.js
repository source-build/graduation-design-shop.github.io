import{N as J}from"./index.es.202406102048.js";import{d as j,u as K,a as r,o as Q,C as D,n as t,c as h,e as u,j as O,w as L,g as e,k as q,h as l,l as E,p as F,m as G,_ as z,f as k,t as c,q as T,F as ae,i as ne,s as de,v as ie,x as H}from"./index.202406102048.js";import{A as U}from"./index.20240610204824.js";import{A as ce}from"./index.20240610204823.js";import{d as M,m as le}from"./format.202406102048.js";import{_ as re}from"./index.20240610204830.js";import{u as ue}from"./order.202406102048.js";import{s as pe}from"./function-call.202406102048.js";import"./is.202406102048.js";const _e=o=>(F("data-v-03179d6f"),o=o(),G(),o),me=_e(()=>e("div",{class:"address-header"},"选择收货地址",-1)),ve={class:"address-body"},he={class:"address-actions"},fe=j({__name:"SelectAddress",props:{modelValue:Boolean},emits:["update:modelValue","select"],setup(o,{expose:f,emit:g}){const n=g,b=K(),w={display:"flex","flex-direction":"column","align-items":"stretch","max-height":"80%","min-height":"50%","overflow-y":"visible","font-size":"14px"},p=r([]),N=r(!1),$=r("");Q(()=>{P()});function A(_,i){n("select",_,i),C()}function P(){N.value=!0,D.userShoppingAddressList().then(_=>{var i;p.value=((i=_.data)==null?void 0:i.result)??[],t(p).length&&($.value=t(p)[0].id)}).finally(()=>{N.value=!1})}function B(){b.push({path:"/address",query:{origin:"selected"}})}function C(){v(!1)}function R(){v(!0)}function v(_){n("update:modelValue",_)}return f({open:R,close:C,updateShow:v}),(_,i)=>{const y=h("van-button"),S=h("van-popup");return u(),O(S,{show:o.modelValue,round:"",closeable:"",position:"bottom",style:w,"onUpdate:show":v},{default:L(()=>[me,e("div",ve,[p.value.length?(u(),O(re,{key:0,modelValue:$.value,"onUpdate:modelValue":i[0]||(i[0]=V=>$.value=V),class:"address-list",switchable:"",list:p.value,onSelect:A},null,8,["modelValue","list"])):q("",!0)]),e("div",he,[l(y,{type:"primary",round:"",block:"",onClick:B},{default:L(()=>[E("新增地址")]),_:1})])]),_:1},8,["show"])}}});const ge=z(fe,[["__scopeId","data-v-03179d6f"]]),be=j({name:"GoodCard",props:{good:{type:Object,default:()=>({})}},setup(){function o(f){return f.map(g=>g.childName).join(",")}return{decimalFormat:M,propTitle:o}}});const ye=o=>(F("data-v-03a75c00"),o=o(),G(),o),Se={class:"good-card"},ke={class:"good-card-content"},Ie={class:"good-card-title"},we={class:"good-card-desc"},$e={key:0,class:"good-card-prop"},Ae={class:"good-card-bottom"},Ce={class:"good-card-price"},Ve=ye(()=>e("span",{class:"good-card-price-symbol"},"¥",-1)),xe={class:"good-card-price-integer"},Le={class:"good-card-number"};function Ne(o,f,g,n,b,w){const p=h("van-image");return u(),k("div",Se,[l(p,{fit:"contain",class:"good-card-pic",src:o.good.pic},null,8,["src"]),e("div",ke,[e("div",Ie,c(o.good.name),1),e("div",we,[o.good.propertyList&&o.good.propertyList.length?(u(),k("div",$e,c(o.propTitle(o.good.propertyList)),1)):q("",!0)]),e("div",Ae,[e("div",Ce,[Ve,e("span",xe,c(o.decimalFormat(o.good.price)),1)]),e("div",Le,"x"+c(o.good.number),1)])])])}const Te=z(be,[["render",Ne],["__scopeId","data-v-03a75c00"]]),I=o=>(F("data-v-65bdcd2e"),o=o(),G(),o),Me={class:"container"},Oe={key:0,class:"section"},Pe={class:"address-sub van-ellipsis"},Be={class:"address-title van-ellipsis"},Re={class:"address-sub van-ellipsis"},Ue={class:"section"},De={class:"section-header van-hairline--bottom"},Ee=I(()=>e("span",{class:"section-header-title"},"商品列表",-1)),je={class:"list"},qe={class:"subtotal"},Fe={class:"subtotal-num"},Ge=I(()=>e("span",{class:"subtotal-label"},"商品小计：",-1)),ze={class:"subtotal-price"},Je=I(()=>e("span",{class:"subtotal-price-symbol"},"¥",-1)),He={class:"subtotal-price-integer"},Ke={class:"section"},Qe={class:"section"},We=I(()=>e("div",{class:"section-header van-hairline--bottom"},[e("span",{class:"section-header-title"},"付款方式")],-1)),Xe={class:"submit-bar-wrap"},Ye={class:"submit-bar"},Ze={class:"submit-bar-hd"},es=I(()=>e("span",{class:"submit-bar-total"},"应付：",-1)),ss={class:"submit-bar-price"},os=I(()=>e("span",{class:"submit-bar-price-symbol"},"¥",-1)),ts={class:"submit-bar-price-integer"},as={name:"OrderSubmit"},ns=j({...as,setup(o){Q(()=>{t(S)&&$(),B(),R()});const f=K(),g=ue(),n=r({}),b=r(!1);function w(){b.value=!0}function p(a,s,d){let m=a;return s.length>1&&s!==a&&(m+=`${s}`),d.length>1&&(m+=`${d}`),m}function N(a){n.value=a}function $(){D.userShoppingAddressDefault().then(a=>{var s;n.value=((s=a.data)==null?void 0:s.info)??{}})}const A=r(0),P=r(!0);function B(){D.userAmount().then(a=>{var s;A.value=((s=a.data)==null?void 0:s.balance)??0})}const C=r({});function R(){U.orderSet().then(a=>{C.value=a.data||{}})}const v=r(""),_=T(()=>g.getTradeGoods),i=T(()=>t(_).list),y=r(!1),S=T(()=>t(i).some(a=>a.logisticsId!==0)),V=T(()=>t(i).reduce((a,s)=>J.plus(a,J.times(s.price,s.number)),0));function W(){if(t(S)&&!t(n).linkMan){de({message:"地址栏不能为空",duration:1500});return}if(t(A)<t(V)){pe({title:"余额不足",message:"积分兑换成余额，再来消费",confirmButtonText:"我知道了"}).then(()=>{}).catch(()=>{});return}X()}async function X(){const a=t(i).map(d=>({goodsId:d.goodsId,number:d.number,propertyChildIds:d.propertyList.map(m=>m.propIds).join(",")})),s={calculate:!1,goodsType:0,goodsJsonStr:JSON.stringify(a),expireMinutes:t(C).closeMinute||60,remark:t(v)};t(S)?(s.peisongType="kd",s.linkMan=t(n).linkMan,s.mobile=t(n).mobile,s.address=t(n).address,s.provinceId=t(n).provinceId,s.cityId=t(n).cityId,s.districtId=t(n).districtId):s.autoDeliver=!0,ie({forbidClick:!0,message:"订单创建中...",duration:0}),y.value=!0;try{const d=await U.orderCreate(s);t(_).origin==="cart"&&Z(),await Y(d.data.id),H(),y.value=!1,f.replace({path:"/order/payResult",query:{orderNumber:d.data.orderNumber}})}catch(d){H(),y.value=!1,console.error(d)}}function Y(a){return U.orderPay({orderId:a})}function Z(){ce.shoppingCartEmpty().then(()=>{}).catch(a=>{console.log(a)})}return(a,s)=>{const d=h("van-icon"),m=h("van-cell"),ee=h("van-field"),se=h("van-checkbox"),oe=h("van-button");return u(),k("div",Me,[S.value?(u(),k("div",Oe,[n.value.linkMan?(u(),k("div",{key:0,class:"address",onClick:w},[e("div",Pe,c(p(n.value.provinceStr,n.value.cityStr,n.value.areaStr)),1),e("div",Be,c(n.value.address),1),e("div",Re,c(n.value.linkMan)+" "+c(t(le)(n.value.mobile)),1),l(d,{class:"address-arrow",name:"arrow"})])):(u(),O(m,{key:1,class:"address-card mb10",title:"新增收货地址",icon:"add-square","is-link":"",onClick:w})),l(m,{title:"配送方式",value:"快递"}),l(ge,{modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=x=>b.value=x),onSelect:N},null,8,["modelValue"])])):q("",!0),e("div",Ue,[e("div",De,[l(d,{class:"section-header-icon",name:"shop-o"}),Ee]),e("div",je,[(u(!0),k(ae,null,ne(i.value,(x,te)=>(u(),O(Te,{key:te,good:x},null,8,["good"]))),128))]),e("div",qe,[e("span",Fe,"共"+c(i.value.length)+"件",1),Ge,e("span",ze,[Je,e("span",He,c(t(M)(V.value)),1)])])]),e("div",Ke,[l(ee,{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=x=>v.value=x),label:"买家留言",type:"textarea",placeholder:"留言建议提前协商（250字以内）",maxlength:"250",rows:"1",autosize:""},null,8,["modelValue"])]),e("div",Qe,[We,l(m,{title:"余额",center:""},{label:L(()=>[E(" 账户余额："+c(t(M)(A.value)),1)]),"right-icon":L(()=>[l(se,{"model-value":P.value},null,8,["model-value"])]),_:1})]),e("div",Xe,[e("div",Ye,[e("div",Ze,[es,e("div",ss,[os,e("span",ts,c(t(M)(V.value)),1)])]),l(oe,{class:"submit-bar-button",loading:y.value,round:"",type:"primary",onClick:W},{default:L(()=>[E(" 提交订单 ")]),_:1},8,["loading"])])])])}}});const vs=z(ns,[["__scopeId","data-v-65bdcd2e"]]);export{vs as default};
