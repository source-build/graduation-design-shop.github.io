import{_ as ee}from"./index.20240610204818.js";import{_ as te}from"./index.vue_vue_type_script_lang.202406102048.js";import{N as E}from"./index.es.202406102048.js";import{d as U}from"./format.202406102048.js";import{A as w}from"./index.20240610204823.js";import{u as se}from"./order.202406102048.js";import{u as oe}from"./usePage.202406102048.js";import{n as t,d as ne,o as ae,a as A,q as I,c as C,e as l,f as d,h as p,w as g,g as o,F as T,t as f,k as L,s as P,p as ie,m as le,i as ce,l as y,j as D,v as re,x as de,_ as ue}from"./index.202406102048.js";import{s as me}from"./function-call.202406102048.js";import"./is.202406102048.js";import"./index.20240610204824.js";function pe(u,_){function c(...i){u(()=>_.apply(this,i),{fn:_,thisArg:this,args:i})}return c}function _e(u,_={}){let c,i;return h=>{const x=t(u),n=t(_.maxWait);if(c&&clearTimeout(c),x<=0||n!==void 0&&n<=0)return i&&(clearTimeout(i),i=null),h();n&&!i&&(i=setTimeout(()=>{c&&clearTimeout(c),i=null,h()},n)),c=setTimeout(()=>{i&&clearTimeout(i),i=null,h()},x)}}function he(u,_=200,c={}){return pe(_e(_,c),u)}const ve=""+new URL("png/cart.202406102048.png",import.meta.url).href,ge=""+new URL("mp4/shopping-cart.202406102048.mp4",import.meta.url).href,v=u=>(ie("data-v-e94a2c7d"),u=u(),le(),u),fe={class:"container"},ye={key:0,class:"goods"},be={class:"goods-header van-hairline--bottom"},ke={class:"goods-header-hd"},Ce=["src"],Te=v(()=>o("span",null,"购物车",-1)),xe={class:"list"},Se={class:"list-item-selected"},Ve={class:"list-item-content"},we={class:"list-item-title"},Ie={key:0,style:{color:"var(--color-text-4)"}},Le={class:"list-item-desc"},Ne={key:0,class:"list-item-prop"},Ee={class:"list-item-bottom"},Ae={class:"list-item-price"},Pe=v(()=>o("span",{class:"list-item-price-symbol"},"¥",-1)),Fe={class:"list-item-price-integer"},Re=v(()=>o("div",{class:"empty-title"},"购物车快饿瘪了 T.T",-1)),Ue=v(()=>o("div",{class:"empty-txt"},"快给我挑点宝贝",-1)),De=v(()=>o("div",{class:"empty-title"},"登录后才能看到您的购物车",-1)),Ge={class:"submit-bar-wrap"},He={key:0,class:"submit-bar"},Be=v(()=>o("div",{class:"submit-bar-hd"},null,-1)),Me={class:"submit-bar-hd"},je=v(()=>o("span",{class:"submit-bar-total"},"合计：",-1)),Oe={class:"submit-bar-price"},We=v(()=>o("span",{class:"submit-bar-price-symbol"},"¥",-1)),$e={class:"submit-bar-price-integer"},qe={name:"Cart"},Ye=ne({...qe,setup(u){ae(()=>{t(c)?O():b.value=!1});const _=se(),{hasLogin:c,goHome:i,goLogin:F}=oe(),h=A(1);function x(){h.value=t(h)===1?2:1}const n=A([]),b=A(!0),G=ve,H=ge;function B(s){return s.map(e=>e.optionValueName).join(",")}const m=I(()=>t(n).filter(s=>s.selected)),M=I(()=>t(m).reduce((s,e)=>E.plus(s,e.number),0)),j=I(()=>t(m).reduce((s,e)=>E.plus(s,E.times(e.price,e.number)),0)),R=I({get(){return t(m).length===t(n).length},set(s){t(n).forEach(e=>{e.selected=s})}});function O(){b.value=!0,w.shoppingCartInfo().then(s=>{var e;n.value=((e=s.data)==null?void 0:e.items)??[]}).finally(()=>{b.value=!1})}const W=he((s,e)=>{const{key:r}=t(n)[e];q(e,{key:r,number:s})},1e3);function $(){if(!t(m).length){P({message:"您还没有选择商品哦",duration:1500});return}const s=t(m).length===t(n).length?"empty":"remove",e=s==="empty"?"确定要清空购物车吗？":`确定要删除这${t(m).length}个商品吗？`;me({message:e}).then(()=>{s==="empty"?Y():z()}).catch(r=>{console.log(r)})}function q(s,{key:e,number:r}){re({forbidClick:!0,message:"修改中...",duration:0}),w.shoppingCartModifyNumber({number:r,key:e}).then(k=>{var S;de(),n.value=((S=k.data)==null?void 0:S.items)??[]}).catch(k=>{console.log(k)})}function Y(){w.shoppingCartEmpty().then(()=>{n.value=[]}).catch(s=>{console.log(s)})}function z(){const s=t(m).map(e=>e.key).join(",");w.shoppingCartRemove({key:s}).then(e=>{var r;n.value=((r=e.data)==null?void 0:r.items)??[]}).catch(e=>{console.log(e)})}function J(){if(!t(m).length){P({message:"您还没有选择商品哦",duration:1500});return}if(t(m).some(s=>s.status===1)){P({message:"请删除掉失效商品",duration:1500});return}_.setTradeGoods({origin:"cart",list:t(m)})}return(s,e)=>{const r=C("van-checkbox"),k=C("van-image"),S=C("van-stepper"),V=C("van-button"),K=C("van-empty"),Q=te,X=ee;return l(),d("div",fe,[p(Q,{loading:b.value,"onUpdate:loading":e[0]||(e[0]=a=>b.value=a)},{default:g(()=>[n.value.length?(l(),d("div",ye,[o("div",be,[o("div",ke,[o("video",{class:"goods-header-cart",src:t(H),width:"40",height:"40",autoplay:"",muted:"",loop:"",type:"video/mp4"},null,8,Ce),Te]),o("div",{class:"goods-header-bd",onClick:x},f(h.value===1?"编辑":"完成"),1)]),o("div",xe,[(l(!0),d(T,null,ce(n.value,(a,Z)=>(l(),d("div",{key:a.key,class:"list-item"},[o("div",Se,[p(r,{modelValue:a.selected,"onUpdate:modelValue":N=>a.selected=N},null,8,["modelValue","onUpdate:modelValue"])]),p(k,{fit:"contain",class:"list-item-pic",src:a.pic},null,8,["src"]),o("div",Ve,[o("div",we,[a.status===1?(l(),d("span",Ie,"【失效】")):L("",!0),y(" "+f(a.name),1)]),o("div",Le,[a.sku&&a.sku.length?(l(),d("div",Ne,f(B(a.sku)),1)):L("",!0)]),o("div",Ee,[o("div",Ae,[Pe,o("span",Fe,f(t(U)(a.price)),1)]),a.status===0?(l(),D(S,{key:0,"model-value":a.number,"async-change":"",class:"sku-num-stepper",onChange:N=>t(W)(N,Z)},null,8,["model-value","onChange"])):L("",!0)])])]))),128))])])):(l(),D(K,{key:1,class:"empty",image:t(G)},{default:g(()=>[t(c)?(l(),d(T,{key:0},[Re,Ue,p(V,{class:"empty-btn",round:"",plain:"",type:"primary",onClick:t(i)},{default:g(()=>[y("去逛逛")]),_:1},8,["onClick"])],64)):(l(),d(T,{key:1},[De,p(V,{class:"empty-btn",type:"primary",round:"",onClick:t(F)},{default:g(()=>[y("去登录")]),_:1},8,["onClick"])],64))]),_:1},8,["image"]))]),_:1},8,["loading"]),o("div",Ge,[n.value.length?(l(),d("div",He,[p(r,{modelValue:R.value,"onUpdate:modelValue":e[1]||(e[1]=a=>R.value=a)},{default:g(()=>[y("全选")]),_:1},8,["modelValue"]),h.value===2?(l(),d(T,{key:0},[Be,p(V,{class:"submit-bar-button",round:"",plain:"",onClick:$},{default:g(()=>[y("删除")]),_:1})],64)):(l(),d(T,{key:1},[o("div",Me,[je,o("div",Oe,[We,o("span",$e,f(t(U)(j.value)),1)])]),p(V,{class:"submit-bar-button",round:"",type:"primary",onClick:J},{default:g(()=>[y("去结算("+f(M.value)+")",1)]),_:1})],64))])):L("",!0)]),p(X)])}}});const at=ue(Ye,[["__scopeId","data-v-e94a2c7d"]]);export{at as default};
